<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/lib/heredoc.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../prettify.css">
    <link rel="stylesheet" href="../../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header high">
    <h1>Code coverage report for <span class="entity">src/lib/heredoc.js</span></h1>
    <h2>
        Statements: <span class="metric">100% <small>(52 / 52)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">100% <small>(26 / 26)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">100% <small>(10 / 10)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">100% <small>(49 / 49)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../index.html">All files</a> &#187; <a href="index.html">src/lib/</a> &#187; heredoc.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">100</span>
<span class="cline-any cline-yes">100</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-yes">100</span>
<span class="cline-any cline-yes">49</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">51</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">100</span>
<span class="cline-any cline-yes">100</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-yes">49</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">87</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-yes">110</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-yes">14</span>
<span class="cline-any cline-yes">14</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">55</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">31</span>
<span class="cline-any cline-yes">31</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">29</span>
<span class="cline-any cline-yes">29</span>
<span class="cline-any cline-yes">29</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">29</span>
<span class="cline-any cline-yes">29</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
 * module HereDoc
 */
&nbsp;
var jsonfy = require('jsonfy');
var base = require('./base');
&nbsp;
var HereDoc = {};
&nbsp;
var reDocTag = /^\s*@(\w+)\s/mg,
  reDocAsterisk = /^\s*\*[ \t]?/mg;
&nbsp;
/**
 * 提取 hereDoc 中的关键字段，去掉行首和行尾的空格
 *
 * @param {String} hereDocStr
 * @private
 */
function getTags(hereDocStr) {
&nbsp;
  hereDocStr = hereDocStr.replace(reDocAsterisk, '');
&nbsp;
  var start = 0, tagKey, desc = '', tags = {};
&nbsp;
  function addTag(key, val) {
    if (!(key in tags)) { tags[key] = []; }
    tags[key].push(base.trim(val));
  }
&nbsp;
  hereDocStr.replace(reDocTag, function(raw, key, index) {
    if (!start) {
      desc = base.trim(hereDocStr.substring(start, index));
    } else {
      addTag(tagKey, hereDocStr.substring(start, index));
    }
&nbsp;
    tagKey = key;
    start = index + raw.length;
  });
&nbsp;
  if (tagKey) {
    addTag(tagKey, hereDocStr.substr(start));
  }
&nbsp;
  tags.desc = desc;
&nbsp;
  return tags;
}
&nbsp;
&nbsp;
var _firstLine = function (str) { return str.split(/[\r]?\n/).shift();},
  _firstWord = function(str) { /^(\w+)/.test(str); return RegExp.$1; };
&nbsp;
/**
 * 解析 HereDoc 成对象
 *
 * @param {String} hereDocStr
 * @param {Boolean} [forDoc = false]
 * @returns {{rules: Array, names: Array, defaults: Object, options: Object}}
 *
 */
HereDoc.parse = function (hereDocStr, forDoc) {
&nbsp;
  var tags = getTags(hereDocStr);
  var result = {};
&nbsp;
  base.eachArr(['defaults', 'options'], function(k) {
    result[k] = tags[k] ? jsonfy(base.wrapInBrackets(_firstLine(tags[k].pop()))) : {};
  });
&nbsp;
  result.rules = base.map((tags.rules || []).concat(tags.rule || []), _firstLine);
  result.names = base.map((tags.name ? [tags.name.pop()] : []).concat((tags.alias || [])), _firstWord);
&nbsp;
  var map = {};
  result.names = base.filter(result.names, function(name) {
    var exists = name in map;
    map[name] = true;
    return name &amp;&amp; !exists;
  });
&nbsp;
&nbsp;
  if (forDoc) {
    result.examples = tags.example || [];
    result.desc = tags.desc;
  }
&nbsp;
  return result;
};
&nbsp;
var reDoc = /(\/\*\*[\s\S]*?\*\/)/,
  reFn = /^function\s+(\w*)\s*\((.*)\)/;
&nbsp;
/**
 * 通过 fn.toString() 来得到函数内部定义的 hereDoc
 *
 * @param {Function} fn
 * @returns {String|Boolean}
 */
HereDoc.getFromFunc = function(fn) {
  reDoc.test(fn.toString());
  return RegExp.$1 || false;
};
&nbsp;
/**
 * 得到函数的 arguments 及 name
 */
HereDoc.parseFunc = function(fn) {
  reFn.test(fn.toString());
  var args = base.trim(RegExp.$2);
  var name = RegExp.$1;
&nbsp;
  args = args ? args.split(/\s*,\s*/) : [];
  return {name: name, arguments: args};
};
&nbsp;
&nbsp;
module.exports = HereDoc;
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri May 15 2015 08:38:10 GMT+0800 (CST)</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>

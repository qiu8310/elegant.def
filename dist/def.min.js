!function(){function t(t){return{}.toString.call(t).slice(8,-1).toLowerCase()}function e(t){return t.trim?t.trim():t.replace(w.gTrim,"")}function n(t){return t.charAt(0).toUpperCase()+t.substr(1)}function r(t,e){for(var n in t)if(t.hasOwnProperty(n)&&e(t[n],n,t)===!1)break}function i(t,e){for(var n=0;n<t.length&&e(t[n],n,t)!==!1;++n);}function u(t,e){var n=[];return t.map?t.map(e):i(t,function(){n.push(e.apply(null,arguments))})||n}function s(t,e){var n=[];return t.filter?t.filter(e):i(t,function(t){e.apply(null,arguments)&&n.push(t)})||n}function o(t,e){return[].slice.call(t,e||0)}function a(t){return A.isObject(t)||(t={}),i(o(arguments,1),function(e){A.isObject(e)&&r(e,function(e,n){t[n]=e})}),t}function c(t,e){var i="\r\n",u="	";throw r(e,function(e,r){t+=i+u+n(r)+": "+e.toString()}),new Error(t)}function l(t){return w.numerical.test(t)?~t.indexOf(".")?"0"!==t.charAt(0)||"."===t.charAt(1):"0"!==t.charAt(0):!1}function f(t){return A.isNumber(t)&&-1===String(t).indexOf(".")}function p(t){if(!A.isString(t))return t;if(""===t)return void 0;var e=t.charAt(0),n=t.charAt(t.length-1);if(e===n&&('"'===e||"'"===e))return t.slice(1,-1);var r=t.toLowerCase();return r in _?_[r]:l(t)?~t.indexOf(".")?parseFloat(t):parseInt(t,10):t}function h(t){var n={},r=t.toString();return w.hereDoc.test(r)&&RegExp.$1.replace(w.gHereDocItem,function(t,r,i){r=e(r).toLowerCase(),r in n||(n[r]=[]),n[r].push(e(i))}),n}function g(t){return s(t||[],function(t){return w.rule.test(t)})}function d(t){var n=t.length,r={};return"{"===t.charAt(0)&&"}"===t.charAt(n-1)&&(t=t.substr(1,n-2),i(t.split(","),function(t){t=t.split(":"),r[e(t[0])]=p(e(t[1]))})),r}function m(t){var e={};return i(t||[],function(t){a(e,d(t))}),e}function y(t,e){var n=this;e=e||{};var r=e.rules||[],s=e.defaults||{},l=e.options||{},f=h(t);return s=a(m(f.defaults),s),l=a({},b,m(f.options),l),r=u(r.concat(g(f.rule)),function(t){return new v(t)}),function(){var e,f=o(arguments),p=!1,h={"function":t.toString().replace(w.gEOL," ").substr(0,100),arguments:u(f,function(t){return String(t)}).join(","),rules:u(r,function(t){return t.raw}).join("; ")};if(0===r.length&&c("No rules.",h),i(r,function(t){return p=t.match(f),p?(e=t,!1):void 0}),p){var g={arguments:f,$rule:e};return a(g,s,p),l.applySelf?t.apply(g,f):t.call(n,g)}c("Arguments match no rule.",h)}}function v(t){var n=this;this.raw=e(t),this.keys=[],this.keysAry=[],this.keyOpts={},w.rule.test(this.raw),this.rawArgs=e(RegExp.$1),this.returnType=e(RegExp.$2),""===this.rawArgs||"*"===this.rawArgs?this.matchAll=!0:(t=this._parseRuleItems(),this._parseKeysAry(t),i(this.keysAry,function(t){if(A.isString(t)){var e=n.keyOpts[t];e.optional=!1,A.isUndefined(e.defaultValue)||n._error("Not optional key `"+t+"` can not set default value `"+e.defaultValue+"`.")}}))}var w={hereDoc:/\/\*\*([\s\S]*?)\*\//,gHereDocItem:/^\s*\*\s*@(\w+)\s+(.*?)\s*$/gm,gTrim:/^\s*|\s*$/g,gComma:/,/g,gEOL:/[\r\n]+/g,word:/^\w+$/,gSpace:/\s+/g,numerical:/^(?:\d*\.)?\d+$/,gBracket:/([\[\]])/g,rule:/\(([^\)]*)\)\s*->\s*(\*|\w+)/,gRuleArgsItem:/(\*|\w+)\s+(\w+)\s*(?:=\s*([^,\[\]]*))?/g},A={},b={applySelf:!1};i("Object,Number,String,Array,Boolean,Undefined,Function".split(","),function(e){A["is"+e]=function(n){return n===n&&t(n)===e.toLowerCase()}});var _={"true":!0,"false":!1,"null":null},k="*,int,number,string,object,array,function,arguments,boolean,null,nature,positive,negative".split(","),O={integer:"int",signed:"int",bool:"boolean",unsigned:"nature"};i(k,function(t){O[t]=t}),y.is=function(e,n){n=n&&n.toLowerCase(),n in O||c("Type: "+n+" is not exists."),n=O[n];var r=O[n+"___check"];if(r)return r(e);switch(n){case"*":return!0;case"int":return f(e);case"number":return A.isNumber(e);case"nature":return f(e)&&e>=0;case"positive":return f(e)&&e>0;case"negative":return f(e)&&0>e;default:return t(e)===n}},y.type=function(t,e){O[t]=t,O[t+"___check"]=e},y.untype=y.unType=function(t){var e=t+"___check";return e in O?(delete O[t],delete O[e],!0):!1},y.config=function(t,e){return A.isUndefined(e)?b[t]:void(t in b&&(b[t]=e))},v.prototype={_error:function(t){var e=this.raw;c(t,{rule:e})},_parseRuleItems:function(){var t=this.keyOpts,n=this.keys,r=this;return this.rawArgs.replace(w.gRuleArgsItem,function(i,u,s,o){return s in t&&r._error("Argument name `"+s+"` duplicated"),A.isUndefined(o)||(o=p(e(o)),y.is(o,u)||r._error("Argument name `"+s+"` defaultValue `"+o+"` not is `"+u+"`")),n.push(s),t[s]={type:u,defaultValue:o,optional:!0},s})},_parseKeysAry:function(t){var e=this,n=this.keysAry,r=[n];t=t.replace(w.gComma," "),t=t.replace(w.gBracket," $1 "),i(t.split(w.gSpace),function(t){if("["===t){var i=[];n.push(i),r.push(i),n=i}else"]"===t?(r.pop(),n=r[r.length-1]):w.word.test(t)&&(t in e.keyOpts?n.push(t):e._error("Key word `"+t+"` not exists"))})},_allPossible:function(){var t=function(e){var n=[[]];return i(e,function(e){if(A.isArray(e)){var r=n.length;i(t(e),function(t){var e,i;for(e=0;r>e;e++)i=[].concat(n[e]),n.push(i.concat(t))})}else i(n,function(t){t.push.apply(t,[].concat(e))})}),n};return t(this.keysAry)},match:function(t){var e={};if(this.matchAll)return e;var n,u,s=t.length,o=this;return i(this._allPossible(),function(e){return e.length===s?(u=e,i(e,function(e,r){return n=o.keyOpts[e],y.is(t[r],n.type)?void 0:(u=!1,!1)}),!u):void 0}),u?(r(o.keyOpts,function(t,n){A.isUndefined(t.defaultValue)||(e[n]=t.defaultValue)}),i(u,function(n,r){e[n]=t[r]}),e):!1}},"object"==typeof module&&"object"==typeof module.exports?module.exports=y:("undefined"!=typeof window?window:this).def=y}();